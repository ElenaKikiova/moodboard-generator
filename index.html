<!DOCTYPE html>

<html lang="en">
	<head>
		<meta charset="UTF-8" />
	</head>
	<body>
		<h1>Moodboard Generator</h1>
		<button id="generateBtn">Generate Moodboard</button>
		<div id="loader" style="display: none">Generating moodboardâ€¦</div>

		<img id="resultImg" style="display: none; max-width: 100%" />

		<script>
			const generateBtn = document.getElementById("generateBtn");
			const resultImg = document.getElementById("resultImg");

			const loadImage = (imageUrl, refetch) => {
				setTimeout(() => {
					resultImg.src = imageUrl;
					refetch++;
					resultImg.onload = () => {
						loader.style.display = "none";
						resultImg.style.display = "block";
					};
					resultImg.onerror = () => {
						if (refetch < 20) {
							console.log("refetch", refetch);
							loadImage(imageUrl, refetch);
						}
					};
				}, 1500 * refetch);
			};

			generateBtn.addEventListener("click", async () => {
				const response = await fetch("http://localhost:8080/generate-moodboard", {
					method: "POST",
					headers: {
						"Content-Type": "application/json",
					},
					body: JSON.stringify({
						theme: "spring, greenery, flowers, dew",
						style: "soft painterly style, bright",
						color: "carmine, yellow",
					}),
				});

				const data = await response.json();
				const imageUrl = data.image_url;

				loadImage(imageUrl, 0);
			});
		</script>
	</body>
</html>
