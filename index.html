<!DOCTYPE html>

<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<style>
			body {
				font-family: Verdana, Geneva, Tahoma, sans-serif;
				margin: 40px;
				color: #333;
			}

			* {
				box-sizing: border-box;
			}

			h1 {
				text-align: center;
				margin-bottom: 30px;
			}

			.container {
				display: flex;
				width: 100%;
				gap: 20px;
			}

			.left {
				max-width: 80%;
				min-width: 300px;
			}

			.right {
				min-width: 400px;
				flex-grow: 1;
				text-align: center;
			}

			label {
				display: block;
				margin-bottom: 10px;
			}

			input[type="text"] {
				width: 100%;
				padding: 8px;
				border: 1px solid #ccc;
				border-radius: 4px;
				font-size: 1rem;
			}

			button {
				padding: 10px 20px;
				font-size: 1rem;
				border: none;
				border-radius: 4px;
				background-color: #4caf50;
				color: white;
				cursor: pointer;
				margin-top: 10px;
			}

			button:hover {
				background-color: #45a049;
			}

			#loader {
				margin-top: 15px;
				font-weight: bold;
			}

			#resultImg {
				display: block;
				margin-top: 20px;
				max-width: 100%;
				border: 1px solid #ccc;
				border-radius: 4px;
			}

			.input-group {
				margin-bottom: 15px;
			}
		</style>
	</head>
	<body>
		<h1>Moodboard Generator</h1>
		<div class="container">
			<div class="left">
				<div class="input-group">
					<label
						>Theme:
						<input
							type="text"
							id="theme"
							value="seaside, summer, vacation, leisure, relax, fun"
						/>
					</label>
				</div>

				<div class="input-group">
					<label
						>Style:
						<input type="text" id="style" value="soft painterly style, bright" />
					</label>
				</div>

				<div class="input-group">
					<label
						>Color:
						<input type="text" id="color" value="turquoise" />
					</label>
				</div>
			</div>

			<div class="right">
				<img
					id="resultImg"
					src="https://www.svgrepo.com/show/508699/landscape-placeholder.svg"
				/>
				<button id="generateBtn">Generate Moodboard</button>
				<div id="loader" style="display: none">Generating moodboardâ€¦</div>
			</div>
		</div>

		<script>
			const generateBtn = document.getElementById("generateBtn");
			const resultImg = document.getElementById("resultImg");

			const loadImage = (imageUrl, refetch) => {
				setTimeout(() => {
					resultImg.src = imageUrl;
					refetch++;
					resultImg.onload = () => {
						loader.style.display = "none";
						resultImg.style.display = "block";
					};
					resultImg.onerror = () => {
						if (refetch < 20) {
							console.log("refetch", refetch);
							loadImage(imageUrl, refetch);
						}
					};
				}, 1500 * refetch);
			};

			generateBtn.addEventListener("click", async () => {
				const theme = document.getElementById("theme").value;
				const style = document.getElementById("style").value;
				const color = document.getElementById("color").value;

				loader.style.display = "block";
				resultImg.style.display = "none";

				try {
					const response = await fetch("http://localhost:8080/generate-moodboard", {
						method: "POST",
						headers: { "Content-Type": "application/json" },
						body: JSON.stringify({ theme, style, color }),
					});

					const data = await response.json();

					const imageUrl = data.image_url;

					// Start checking for image after 2s
					setTimeout(() => {
						loadImage(imageUrl, 0);
					}, 2000);
				} catch (err) {
					loader.style.display = "none";
					alert("Error: " + err.message);
				}
			});
		</script>
	</body>
</html>
